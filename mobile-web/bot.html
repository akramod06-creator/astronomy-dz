<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="./assets/logo.png?v=20260215-toplogo" />
  <link rel="apple-touch-icon" href="./assets/logo.png?v=20260215-toplogo" />
  <script>
    (() => {
      if (location.protocol === "http:" || location.protocol === "https:") {
        const manifest = document.createElement("link");
        manifest.rel = "manifest";
        manifest.href = "./manifest.webmanifest";
        document.head.appendChild(manifest);
      }
    })();
  </script>
  <meta name="theme-color" content="#0d274c" />
  <title>الموسوعة الفلكية الذكية | Astronomy DZ</title>
  <style>
    :root {
      --bg0: #040913;
      --bg1: #081124;
      --line: rgba(118, 214, 255, 0.24);
      --line-strong: rgba(111, 219, 255, 0.52);
      --text: #e8f6ff;
      --muted: #9cb7d3;
      --panel: rgba(8, 18, 34, 0.64);
      --panel-strong: rgba(7, 16, 31, 0.78);
      --accent: #6be8ff;
      --bot: rgba(24, 64, 97, 0.66);
      --user: rgba(18, 104, 134, 0.58);
      --glow: 0 0 0 1px rgba(111, 219, 255, 0.22), 0 10px 34px rgba(0, 0, 0, 0.4);
      --portrait: url("./assets/images/astro-bot-bg.jpg");
      --space: url("./assets/images/space-bg.jpg");
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "IBM Plex Sans Arabic", "Cairo", "Segoe UI", Tahoma, Arial, sans-serif;
    }

    *::-webkit-scrollbar {
      width: 9px;
      height: 9px;
    }

    *::-webkit-scrollbar-track {
      background: rgba(7, 17, 33, 0.58);
      border-radius: 999px;
    }

    *::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, rgba(91, 200, 255, 0.74), rgba(41, 117, 186, 0.74));
      border-radius: 999px;
    }

    html,
    body {
      min-height: 100vh;
    }

    body {
      position: relative;
      color: var(--text);
      background:
        radial-gradient(1100px 840px at 10% 0%, rgba(30, 73, 172, 0.27), transparent 64%),
        radial-gradient(920px 690px at 96% 92%, rgba(12, 132, 188, 0.2), transparent 66%),
        linear-gradient(160deg, var(--bg1), var(--bg0) 62%);
      display: grid;
      place-items: center;
      padding: 12px;
      overflow: auto;
    }

    body::before {
      content: "";
      position: fixed;
      inset: -4%;
      pointer-events: none;
      background-image: var(--space);
      background-size: cover;
      background-position: center;
      opacity: 0.22;
      filter: saturate(1.04) contrast(1.04) brightness(0.78);
      transform: scale(1.03);
      z-index: 0;
    }

    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 20% 15%, rgba(110, 242, 255, 0.1), transparent 36%),
        linear-gradient(transparent 96%, rgba(109, 227, 255, 0.07) 100%),
        repeating-linear-gradient(90deg, transparent, transparent 56px, rgba(102, 216, 255, 0.05) 57px);
      mix-blend-mode: screen;
      opacity: 0.5;
      animation: hudPulse 8s ease-in-out infinite alternate;
      z-index: 1;
    }

    .app {
      width: min(1420px, 100%);
      min-height: min(95vh, 1080px);
      position: relative;
      z-index: 2;
      border: 1px solid var(--line);
      border-radius: 18px;
      overflow: hidden;
      background: rgba(4, 10, 21, 0.56);
      backdrop-filter: blur(12px) saturate(120%);
      box-shadow: 0 20px 55px rgba(0, 0, 0, 0.58), inset 0 0 0 1px rgba(132, 214, 255, 0.16);
      display: grid;
      grid-template-columns: 340px 1fr;
    }

    .app::after {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background-image: var(--portrait);
      background-size: cover;
      background-position: center;
      opacity: 0.2;
      filter: saturate(1.05) contrast(1.05);
      z-index: 0;
    }

    .app::before {
      content: "";
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        linear-gradient(180deg, rgba(17, 43, 70, 0.19), rgba(6, 16, 31, 0.72)),
        radial-gradient(120% 120% at 100% 0%, rgba(91, 202, 255, 0.09), transparent 42%);
      z-index: 1;
    }

    .app > * {
      position: relative;
      z-index: 2;
    }

    .side {
      border-left: 1px solid var(--line);
      background: linear-gradient(180deg, rgba(8, 18, 36, 0.82), rgba(5, 13, 28, 0.78));
      display: grid;
      grid-template-rows: auto auto auto 1fr auto;
      gap: 12px;
      padding: 14px;
    }

    .title {
      font-size: 22px;
      font-weight: 800;
      letter-spacing: 0.25px;
      color: #d8f7ff;
      text-shadow: 0 0 18px rgba(95, 220, 255, 0.34);
    }

    .sub {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.75;
    }

    .box {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: var(--panel);
      box-shadow: var(--glow);
      padding: 10px;
      display: grid;
      gap: 8px;
    }

    .ai-grid {
      display: grid;
      gap: 7px;
    }

    .ai-grid input,
    .ai-grid select {
      width: 100%;
    }

    .ai-status {
      font-size: 12px;
      color: #9fc5e8;
      border: 1px solid rgba(117, 213, 255, 0.2);
      border-radius: 10px;
      padding: 7px 9px;
      background: rgba(8, 18, 36, 0.45);
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    button,
    select,
    input {
      border-radius: 10px;
      border: 1px solid rgba(126, 214, 255, 0.35);
      background: rgba(9, 21, 43, 0.9);
      color: var(--text);
      padding: 9px 10px;
      font-size: 13px;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease, transform 0.18s ease;
    }

    button {
      cursor: pointer;
      background: linear-gradient(180deg, rgba(26, 78, 125, 0.94), rgba(16, 46, 83, 0.94));
      box-shadow: inset 0 0 0 1px rgba(133, 223, 255, 0.14);
    }

    button:hover {
      border-color: var(--line-strong);
      box-shadow: 0 0 0 1px rgba(91, 225, 255, 0.34), 0 10px 26px rgba(9, 34, 63, 0.36);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
    }

    input:focus,
    select:focus {
      border-color: var(--line-strong);
      box-shadow: 0 0 0 3px rgba(94, 221, 255, 0.13);
    }

    .status {
      font-size: 12px;
      color: #b9e8ff;
      border: 1px solid rgba(117, 213, 255, 0.34);
      border-radius: 10px;
      padding: 8px 10px;
      background: rgba(8, 18, 36, 0.62);
      box-shadow: inset 0 0 0 1px rgba(118, 210, 255, 0.12);
    }

    #missionFeed {
      overflow: auto;
      max-height: 46vh;
      display: grid;
      gap: 8px;
      font-size: 12px;
    }

    .feed-item {
      border: 1px solid rgba(127, 214, 255, 0.24);
      border-radius: 10px;
      background: rgba(9, 21, 40, 0.66);
      padding: 9px;
      line-height: 1.6;
      transition: border-color 0.2s ease, transform 0.18s ease;
    }

    .feed-item:hover {
      border-color: rgba(126, 223, 255, 0.5);
      transform: translateY(-1px);
    }

    .feed-item a {
      color: #d1f0ff;
      text-decoration: none;
    }

    .feed-item a:hover {
      text-decoration: underline;
    }

    .chat {
      display: grid;
      grid-template-rows: auto 1fr auto auto;
      gap: 10px;
      padding: 14px;
      min-height: 0;
    }

    .top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: var(--panel-strong);
      box-shadow: var(--glow);
      padding: 10px;
    }

    .top a {
      color: #d6f2ff;
      text-decoration: none;
      border: 1px solid rgba(113, 216, 255, 0.3);
      border-radius: 9px;
      padding: 7px 10px;
      background: rgba(8, 18, 36, 0.74);
      font-size: 13px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
    }

    .top a:hover {
      border-color: var(--line-strong);
      box-shadow: 0 0 0 1px rgba(100, 221, 255, 0.28);
    }

    .brand-bot {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #cfe6ff;
      white-space: nowrap;
    }

    .brand-bot img {
      width: 34px;
      height: 34px;
      border-radius: 50%;
      object-fit: cover;
      border: 1px solid rgba(140, 210, 255, 0.45);
      box-shadow: 0 0 14px rgba(102, 194, 255, 0.28);
      background: rgba(4, 12, 26, 0.8);
    }

    .messages {
      border: 1px solid var(--line);
      border-radius: 14px;
      background:
        linear-gradient(180deg, rgba(9, 22, 41, 0.75), rgba(7, 15, 30, 0.72));
      box-shadow: inset 0 0 0 1px rgba(111, 214, 255, 0.11);
      overflow: auto;
      padding: 12px;
      display: grid;
      gap: 10px;
      min-height: 0;
      scroll-behavior: smooth;
    }

    .message {
      max-width: min(92%, 860px);
      border: 1px solid rgba(126, 214, 255, 0.26);
      border-radius: 12px;
      padding: 10px 11px;
      line-height: 1.72;
      font-size: 14px;
      white-space: pre-wrap;
      animation: msgRise 0.24s ease;
      box-shadow: inset 0 0 0 1px rgba(117, 214, 255, 0.08);
    }

    .message.bot {
      justify-self: start;
      background: var(--bot);
    }

    .message.user {
      justify-self: end;
      background: var(--user);
      text-align: right;
      border-color: rgba(105, 232, 255, 0.36);
    }

    .quick {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .quick button {
      font-size: 12px;
      padding: 8px 11px;
      border-radius: 999px;
      background: rgba(11, 35, 64, 0.9);
      border-color: rgba(113, 220, 255, 0.36);
    }

    .input {
      border: 1px solid var(--line);
      border-radius: 14px;
      background: var(--panel-strong);
      box-shadow: var(--glow);
      padding: 10px;
      display: grid;
      grid-template-columns: 1fr auto auto auto auto auto auto;
      gap: 8px;
    }

    #ttsBtn.active,
    #micBtn.active,
    #editLastBtn.active {
      border-color: var(--line-strong);
      box-shadow: 0 0 0 1px rgba(99, 220, 255, 0.34);
      background: linear-gradient(180deg, rgba(34, 106, 148, 0.95), rgba(20, 61, 97, 0.95));
    }

    #userInput {
      width: 100%;
      font-size: 14px;
      background: rgba(8, 19, 37, 0.92);
    }

    @keyframes msgRise {
      from {
        opacity: 0;
        transform: translateY(6px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes hudPulse {
      from {
        opacity: 0.38;
      }
      to {
        opacity: 0.62;
      }
    }

    @media (max-width: 1100px) {
      .app {
        grid-template-columns: 1fr;
      }

      .side {
        border-left: 0;
        border-top: 1px solid var(--line);
        order: 2;
      }
    }

    @media (max-width: 740px) {
      body {
        padding: 8px;
      }

      .app {
        min-height: 96vh;
      }

      .chat {
        padding: 10px;
      }

      .input {
        grid-template-columns: 1fr;
      }

      .quick {
        gap: 6px;
      }

      .quick button {
        flex: 1 1 calc(50% - 8px);
      }
    }
  </style>
</head>
<body>
  <section class="app">
    <aside class="side">
      <div>
        <div class="title" id="botTitle">الموسوعة الفلكية الذكية</div>
        <div class="sub" id="botSubtitle">مساعد فلكي عربي يشرح بأسلوب مبسط أو عميق، مع دعم أحدث أخبار الاستكشافات الفضائية.</div>
      </div>

      <div class="box">
        <div class="row">
          <label id="detailModeLabel" for="detailMode">نمط الإجابة</label>
          <select id="detailMode">
            <option value="deep" selected>تحليل عميق (أستاذ فيزياء)</option>
            <option value="balanced">متوازن</option>
            <option value="brief">مختصر</option>
          </select>
        </div>
        <div class="row">
          <button id="syncBtn">تحديث الاستكشافات</button>
          <button id="clearBtn">مسح المحادثة</button>
        </div>
      </div>

      <div class="box ai-grid">
        <strong id="aiHeading" style="font-size:13px;">المحرك الهجين (AI + محلي)</strong>
        <label id="aiModeLabel" for="aiMode" style="font-size:12px;color:#b7d4ef;">وضع المحرك</label>
        <select id="aiMode">
          <option value="auto" selected>تلقائي</option>
          <option value="local">محلي فقط</option>
          <option value="ai">AI فقط</option>
        </select>
        <input id="aiEndpoint" type="text" placeholder="https://.../v1/chat/completions" />
        <input id="aiModel" type="text" placeholder="gpt-4.1-mini" />
        <input id="aiKey" type="password" placeholder="API Key (Bearer)" />
        <div class="row">
          <button id="aiSaveBtn">حفظ إعدادات AI</button>
          <button id="aiTestBtn">اختبار AI</button>
        </div>
        <div id="aiStatus" class="ai-status">AI: غير مهيأ (سيعمل المحرك المحلي)</div>
        <div id="voiceStatus" class="ai-status">الصوت: غير مفعل</div>
      </div>

      <div id="syncStatus" class="status">الحالة: جاهز للمزامنة</div>

      <div class="box">
        <strong id="feedHeading" style="font-size:13px;">استكشافات السنة الحالية</strong>
        <div id="missionFeed"></div>
      </div>
    </aside>

    <main class="chat">
      <div class="top">
        <a id="homeLink" href="./index.html">العودة للرئيسية</a>
        <div class="brand-bot">
          <img src="./assets/logo.png?v=20260215-toplogo" alt="Astronomy DZ Logo" />
          <span id="brandText">Astronomy DZ / Astro Bot</span>
        </div>
      </div>

      <div id="messages" class="messages"></div>

      <div class="quick" id="quickActions">
        <button id="quickLatest" data-prompt="ما الجديد في الاستكشافات الفضائية هذا العام؟">آخر الاستكشافات</button>
        <button id="quickObjects" data-prompt="اشرح لي الفرق بين الكوكب والقمر والنجم">فرق الأجرام</button>
        <button id="quickBlackHoles" data-prompt="كيف تتكون الثقوب السوداء؟">الثقوب السوداء</button>
        <button id="quickCompare" data-prompt="أريد مقارنة فيزيائية بين تيتان والمريخ">تيتان والمريخ</button>
      </div>

      <div class="input">
        <input id="userInput" type="text" placeholder="اكتب سؤالك الفلكي هنا..." />
        <button id="sendBtn">إرسال</button>
        <button id="latestBtn">أخبار السنة</button>
        <button id="regenBtn">إعادة</button>
        <button id="editLastBtn">تعديل آخر</button>
        <button id="micBtn">MIC</button>
        <button id="ttsBtn">TTS OFF</button>
      </div>
    </main>
  </section>

  <script src="./app-settings.js"></script>
  <script src="./pwa-register.js"></script>
  <script src="./bot.js?v=20260217-hybrid5-astrochat"></script>
</body>
</html>

